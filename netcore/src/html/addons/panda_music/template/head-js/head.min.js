/*! head.load - v1.0.3 */
(function (n, t) { "use strict"; function w() { } function u(n, t) { if (n) { typeof n == "object" && (n = [].slice.call(n)); for (var i = 0, r = n.length; i < r; i++)t.call(n, n[i], i) } } function it(n, i) { var r = Object.prototype.toString.call(i).slice(8, -1); return i !== t && i !== null && r === n } function s(n) { return it("Function", n) } function a(n) { return it("Array", n) } function et(n) { var i = n.split("/"), t = i[i.length - 1], r = t.indexOf("?"); return r !== -1 ? t.substring(0, r) : t } function f(n) { (n = n || w, n._done) || (n(), n._done = 1) } function ot(n, t, r, u) { var f = typeof n == "object" ? n : { test: n, success: !t ? !1 : a(t) ? t : [t], failure: !r ? !1 : a(r) ? r : [r], callback: u || w }, e = !!f.test; return e && !!f.success ? (f.success.push(f.callback), i.load.apply(null, f.success)) : e || !f.failure ? u() : (f.failure.push(f.callback), i.load.apply(null, f.failure)), i } function v(n) { var t = {}, i, r; if (typeof n == "object") for (i in n) !n[i] || (t = { name: i, url: n[i] }); else t = { name: et(n), url: n }; return (r = c[t.name], r && r.url === t.url) ? r : (c[t.name] = t, t) } function y(n) { n = n || c; for (var t in n) if (n.hasOwnProperty(t) && n[t].state !== l) return !1; return !0 } function st(n) { n.state = ft; u(n.onpreload, function (n) { n.call() }) } function ht(n) { n.state === t && (n.state = nt, n.onpreload = [], rt({ url: n.url, type: "cache" }, function () { st(n) })) } function ct() { var n = arguments, t = n[n.length - 1], r = [].slice.call(n, 1), f = r[0]; return (s(t) || (t = null), a(n[0])) ? (n[0].push(t), i.load.apply(null, n[0]), i) : (f ? (u(r, function (n) { s(n) || !n || ht(v(n)) }), b(v(n[0]), s(f) ? f : function () { i.load.apply(null, r) })) : b(v(n[0])), i) } function lt() { var n = arguments, t = n[n.length - 1], r = {}; return (s(t) || (t = null), a(n[0])) ? (n[0].push(t), i.load.apply(null, n[0]), i) : (u(n, function (n) { n !== t && (n = v(n), r[n.name] = n) }), u(n, function (n) { n !== t && (n = v(n), b(n, function () { y(r) && f(t) })) }), i) } function b(n, t) { if (t = t || w, n.state === l) { t(); return } if (n.state === tt) { i.ready(n.name, t); return } if (n.state === nt) { n.onpreload.push(function () { b(n, t) }); return } n.state = tt; rt(n, function () { n.state = l; t(); u(h[n.name], function (n) { f(n) }); o && y() && u(h.ALL, function (n) { f(n) }) }) } function at(n) { n = n || ""; var t = n.split("?")[0].split("."); return t[t.length - 1].toLowerCase() } function rt(t, i) { function e(t) { t = t || n.event; u.onload = u.onreadystatechange = u.onerror = null; i() } function o(f) { f = f || n.event; (f.type === "load" || /loaded|complete/.test(u.readyState) && (!r.documentMode || r.documentMode < 9)) && (n.clearTimeout(t.errorTimeout), n.clearTimeout(t.cssTimeout), u.onload = u.onreadystatechange = u.onerror = null, i()) } function s() { if (t.state !== l && t.cssRetries <= 20) { for (var i = 0, f = r.styleSheets.length; i < f; i++)if (r.styleSheets[i].href === u.href) { o({ type: "load" }); return } t.cssRetries++; t.cssTimeout = n.setTimeout(s, 250) } } var u, h, f; i = i || w; h = at(t.url); h === "css" ? (u = r.createElement("link"), u.type = "text/" + (t.type || "css"), u.rel = "stylesheet", u.href = t.url, t.cssRetries = 0, t.cssTimeout = n.setTimeout(s, 500)) : (u = r.createElement("script"), u.type = "text/" + (t.type || "javascript"), u.src = t.url); u.onload = u.onreadystatechange = o; u.onerror = e; u.async = !1; u.defer = !1; t.errorTimeout = n.setTimeout(function () { e({ type: "timeout" }) }, 7e3); f = r.head || r.getElementsByTagName("head")[0]; f.insertBefore(u, f.lastChild) } function vt() { for (var t, u = r.getElementsByTagName("script"), n = 0, f = u.length; n < f; n++)if (t = u[n].getAttribute("data-headjs-load"), !!t) { i.load(t); return } } function yt(n, t) { var v, p, e; return n === r ? (o ? f(t) : d.push(t), i) : (s(n) && (t = n, n = "ALL"), a(n)) ? (v = {}, u(n, function (n) { v[n] = c[n]; i.ready(n, function () { y(v) && f(t) }) }), i) : typeof n != "string" || !s(t) ? i : (p = c[n], p && p.state === l || n === "ALL" && y() && o) ? (f(t), i) : (e = h[n], e ? e.push(t) : e = h[n] = [t], i) } function e() { if (!r.body) { n.clearTimeout(i.readyTimeout); i.readyTimeout = n.setTimeout(e, 50); return } o || (o = !0, vt(), u(d, function (n) { f(n) })) } function k() { r.addEventListener ? (r.removeEventListener("DOMContentLoaded", k, !1), e()) : r.readyState === "complete" && (r.detachEvent("onreadystatechange", k), e()) } var r = n.document, d = [], h = {}, c = {}, ut = "async" in r.createElement("script") || "MozAppearance" in r.documentElement.style || n.opera, o, g = n.head_conf && n.head_conf.head || "head", i = n[g] = n[g] || function () { i.ready.apply(null, arguments) }, nt = 1, ft = 2, tt = 3, l = 4, p; if (r.readyState === "complete") e(); else if (r.addEventListener) r.addEventListener("DOMContentLoaded", k, !1), n.addEventListener("load", e, !1); else { r.attachEvent("onreadystatechange", k); n.attachEvent("onload", e); p = !1; try { p = !n.frameElement && r.documentElement } catch (wt) { } p && p.doScroll && function pt() { if (!o) { try { p.doScroll("left") } catch (t) { n.clearTimeout(i.readyTimeout); i.readyTimeout = n.setTimeout(pt, 50); return } e() } }() } i.load = i.js = ut ? lt : ct; i.test = ot; i.ready = yt; i.ready(r, function () { y() && u(h.ALL, function (n) { f(n) }); i.feature && i.feature("domloaded", !0) }) })(window);
/*
//# sourceMappingURL=head.load.min.js.map
*/
//var g_cdn = "https://cdn.52xyj.cn/xyj.framwork";https://cdn.52xyj.cn/xyj.framwork
var g_pcroot = "/addons/panda_music/template";//注意末尾不能有/
var g_approot = "/addons/panda_music/template";//注意末尾不能有/
var _c = {
    security: {
        encrypt_key: "xyj",
        decrypt_key: "xyj",
        expire:7
    },
    runtime: {
        debug: true,
        fake: false,
        warn: true,
        third_login: false
    },
    sever: {
        host: "https://api.52xyj.cn",//业务服务器
        cdn: "",//https://cdn.52xyj.cn/xyj.framwork
        host_sys: "https://api.52xyj.cn",//框架服务器[权限,报表]
        host_wx: "http://api.52xyj.cn" //微信服务器
    }
};
_c.app = {
        login: g_approot + "/pages/login-m.html", 
        login_auto: g_approot + "/pages/login-auto-m.html",
        homepage: g_approot + "/mobile/index.html",
        login_third:"/"
        //bind: g_approot + "/pages/bind-m.html",
        //wx_login: _c.sever.host_wx + "/WeChat/Web/Authorize?return_url=" + window.location.origin + g_login_wx, //微信自动登陆
        //pay_wx: _c.sever.host_wx + "/WeChat/WeChatPay/JsApiPayPage", //微信支付回调
        //pay_result_wx: window.location.origin + "/web/app/wxpay/charge-result.html?subSystem=system", //微信授权回调
        //wx: _c.sever.host + "/WeChat/WeChatPay/JsApiPayPage", //微信授权
        //charge_wx: "/web/app/" + g_app + "/framework-m/" + "charge.html", //充值
        //charge_result_wx: "/web/app/" + g_app + "/framework-m/" + "charge-result.html", //充值结果
        //wallet_wx: "/web/app/" + g_app + "/framework-m/" + "wallet.html", //钱包
        //withdraw_wx: "/web/app/" + g_app + "/framework-m/" + "-withdraw.html" //提现
};

_c.pc= {
        login: g_pcroot + "/pages/login.html",
        login_auto: g_pcroot + "/pages/login-auto.html",
        homepage: g_pcroot + "/pages/index.html",
        login_third: "/",
        local_res: g_pcroot + "/web/",
        leftmenu: true,
        topmenu: false,
        form: g_pcroot + "/pages/form.html",
        report: g_pcroot + "/pages/report.html"
}
_c.isDebug = _c.runtime.debug;
_c.isApp = window.location.pathname.toLowerCase() == _c.app.login_auto//当前页面是移动端自动登陆页
    ? true
    : window.location.pathname.toLowerCase() == _c.pc.login_auto//当前页面是pc端自动登陆页
        ? false
        : (g_approot !== "" && window.location.pathname.toLowerCase().indexOf("/mobile/") > -1);
_c.root = _c.isApp ? g_approot : g_pcroot;
_c.login = _c.isApp ? _c.app.login : _c.pc.login;
_c.login_auto = _c.isApp ? _c.app.login_auto : _c.pc.login_auto;
_c.homepage = _c.isApp ? _c.app.homepage : _c.pc.homepage;
_c.login_third = _c.runtime.third_login?(_c.isApp ? _c.app.login_third : _c.pc.login_third):"";
//_c.pc.login_3rd_result = g_pcroot +"/pages/login-3rd-result.html";
//_c.pc.login_3rd = _c.sever.host + "/Oauth2/YiBan?returnUrl=" +localUrl(_c.pc.login_3rd_result);
//_c.pc.login_out_3rd = _c.sever.host + "/Json/Login/Logout?returnUrl=" + ;
_c.isAutoLoginPage = function () {
    return $.geturl() === _c.app.login_auto || $.geturl() === _c.pc.login_auto;
}
_c.isLoginPage = function () {
    return $.geturl() === _c.login;
}
_c.isVisitor = function () {
    return $.geturl() !== _c.login &&
        (!$.hasValue($.unitid()) || !$.hasValue($.uid()));
}

function localUrl(url) {
    return window.location.protocol + "//" + window.location.host + g_pcroot +url;
}
function srcurl(src, folder) {

    //1.框架文件（framework目录）  2.程序文件（web目录）   3.cdn资源(调用时无folder参数)
    //自动补齐
    if (folder == undefined) {//3

        if (_c.sever.cdn.indexOf("http") > -1) { //远程cdn
            folder = _c.sever.cdn + "/vendor/";
        } else {//本地cdn
            folder = ((_c.sever.cdn === "/" || _c.sever.cdn === "") ? "/vendor/" : _c.root)
        }
    } else {//1,2
        folder = _c.root + folder;
    }
    var version = "";
    //添加版本号
    if (src.indexOf("head-js") > -1 || folder.indexOf("web") > -1) {
        var now = new Date();
        var number = now.getYear().toString() + now.getMonth().toString() + now.getDate().toString() + now.getHours().toString() + now.getMinutes().toString() + now.getSeconds().toString();
        version = "?v=" + number;
    }
    return folder + src + version;

}
_c.app.lib = {
    src: [
        //layui
        srcurl("layui-m/2.0/need/layer.css"),
        //jquery-weui
        //srcurl("jquery-weui/lib/weui.min.css"),
        //srcurl("jquery-weui/css/jquery-weui.css"),
        //srcurl("jquery-weui/demos/css/demos.css"),
        { "jquery": srcurl("jquery/jquery.min.js") },
        //jquery-weui
        { "fastclick": srcurl("jquery-weui/lib/fastclick.js") },
        //{ "jquery-weui": srcurl("jquery-weui/js/jquery-weui.js") },
        //layui
        { "layui": srcurl("layui-m/2.0/layer.js") },
        //framework
        { "tools": srcurl("tools.js","/head-js/") } //,
        //{ "form-tool": srcurl("framework-m/js/form-tool.js", "/web/app/bx/") }
    ],
    ready: function () {
        FastClick.attach(document.body);
    }
};

_c.pc.lib = {
    src: [
        srcurl("site.css", "/head-js/"),
        srcurl("bootstrap/css/bootstrap.min.css"),
        srcurl("metisMenu/metisMenu.min.css"),
        srcurl("sb2-dist/css/sb-admin-2.css"),
        srcurl("morrisjs/morris.css"),
        srcurl("font-awesome/css/font-awesome.min.css"),
        //bootstrap-switch
        srcurl("bootstrap-switch/static/stylesheets/bootstrap-switch.css"),
        srcurl("bootstrap-switch/static/stylesheets/bootstrap-switch-conquer.css"),
        srcurl("bootstrap-switch/static/stylesheets/flat-ui-fonts.css"),
        //bootstrap-datetime
        srcurl("bootstrap-datetimepicker/css/datetimepicker.css"),
        //bootstrap-daterangepicker
        srcurl("bootstrap-daterangepicker/daterangepicker-bs3.css"),
        //form-validation 
        srcurl("bootstrap-validator/0.5.3/css/bootstrapValidator.css"),
        //datatables-plugins
        srcurl("datatables-plugins/dataTables.bootstrap.css"),
        //datatables-responsive
        srcurl("datatables-responsive/dataTables.responsive.css"),
        srcurl("layui/1.0.9/css/layui.css"),
       
        //umeditor
        srcurl("umeditor/themes/default/css/umeditor.css"),


        //fileUpload
        //srcurl("fileUpload/file/css/style.css"),
        srcurl("fileUpload/file/css/jquery.fileupload.css"),
        srcurl("fileUpload/file/css/blueimp-gallery.min.css"),
        srcurl("fileUpload/file/css/jquery.fileupload.css"),
        srcurl("fileUpload/file/css/jquery.fileupload-ui.css"),


        //framework
        { "jquery": srcurl("jquery/jquery.js") },
        { "bootstrap": srcurl("bootstrap/js/bootstrap.min.js") },
        { "metisMenu": srcurl("metisMenu/metisMenu.min.js") },
        { "raphael": srcurl("raphael/raphael.min.js") },
        { "morris": srcurl("morrisjs/morris.min.js") },
        //{ "morris-data": srcurl("sb2-dist/data/morris-data.js") },
        { "sb-admin-2": srcurl("sb2-dist/js/sb-admin-2.js") },
        //bootstrap-datetime 
        { "bootstrap-datetimepicker": srcurl("bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js") },
        { "bootstrap-datetimepicker-zh": srcurl("bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js") },
        //form-validation
        { "form-validation": srcurl("bootstrap-validator/0.5.3/js/bootstrapValidator.js") },
        { "form-validation-zh": srcurl("bootstrap-validator/0.5.3/js/language/zh_CN.js") },
        //bootstrap-switch 
        { "bootstrap-switch": srcurl("bootstrap-switch/static/js/bootstrap-switch.min.js") },
        //echarts 
        { "bootstrap-switch": srcurl("echarts/3.5.2/echarts.min.js") },
        //umeditor
        { "umeditor-config": srcurl("umeditor/umeditor.config.js") },
        { "umeditor": srcurl("umeditor/umeditor.js") },
        { "umeditor-zh": srcurl("umeditor/lang/zh-cn/zh-cn.js") },
        //bootstrap-daterangepicker
        { "bootstrap-daterangepicker": srcurl("bootstrap-daterangepicker/daterangepicker.js") },
        { "bootstrap-daterangepicker-moment": srcurl("bootstrap-daterangepicker/moment.min.js") },
        //jquery.cookie
        { "jquery-cookie": srcurl("jquery/jquery.cookie.js") },
        //layui
        { "layui": srcurl("layui/1.0.9/layui.js") },
        //jquery-dataTables
        { "jquery-dataTables": srcurl("datatables/js/jquery.dataTables.min.js") },
        //dataTables-bootstrap
        { "dataTables-bootstrap": srcurl("datatables-plugins/dataTables.bootstrap.min.js") },
        //dataTables.responsive
        { "dataTables.responsive": srcurl("datatables-responsive/dataTables.responsive.js") },
        //importxls
        { "importxls-shim": srcurl("importxls/js/shim.js") },
        { "importxls-xls": srcurl("importxls/js/xls.js") },
        //exportxls
        //{ "exportxls": srcurl("exportxls/js/tableExport.js") },
        //export2
        { "export-xlsx-core": srcurl("tableExport.jquery.plugin/libs/js-xlsx/xlsx.core.min.js") },
        { "export-FileSaver": srcurl("tableExport.jquery.plugin/libs/FileSaver/FileSaver.min.js") },
        { "export-jspdf": srcurl("tableExport.jquery.plugin/libs/jsPDF/jspdf.min.js") },
        { "export-jspdf-autotable": srcurl("tableExport.jquery.plugin/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js") },
        { "export-html2canvas": srcurl("tableExport.jquery.plugin/libs/html2canvas/html2canvas.min.js") },
        { "export-tableExport": srcurl("tableExport.jquery.plugin/tableExport.js") },
        /*
            <script type="text/javascript" src="tableExport.jquery.plugin/libs/js-xlsx/xlsx.core.min.js"></script>
            <script type="text/javascript" src="tableExport.jquery.plugin/libs/FileSaver/FileSaver.min.js"></script>
          <script type="text/javascript" src="tableExport.jquery.plugin/libs/jsPDF/jspdf.min.js"></script>
          <script type="text/javascript" src="tableExport.jquery.plugin/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js"></script>
          <script type="text/javascript" src="tableExport.jquery.plugin/libs/html2canvas/html2canvas.min.js"></script>
            <script type="text/javascript" src="tableExport.jquery.plugin/tableExport.js"></script>
        */
        //html-to-pdf
        { "exportxls-jspdf": srcurl("html-to-pdf/js/jspdf.min.js") },
        { "exportxls-html2canvas": srcurl("html-to-pdf/js/html2canvas.min.js") },
        //pym
        { "pym": srcurl("pym-js/src/pym.js") },
        //fileUpload
        { "widget": srcurl("fileUpload/file/js/vendor/jquery.ui.widget.js") },
        { "tmpl": srcurl("fileUpload/file/js/tmpl.min.js") },
        { "load-image": srcurl("fileUpload/file/js/load-image.all.min.js") },
        { "canvas-to-blob": srcurl("fileUpload/file/js/canvas-to-blob.min.js") },
        { "blueimp": srcurl("fileUpload/file/js/jquery.blueimp-gallery.min.js") },
        { "iframe": srcurl("fileUpload/file/js/jquery.iframe-transport.js") },
        { "fileupload": srcurl("fileUpload/file/js/jquery.fileupload.js") },
        { "fileupload-process": srcurl("fileUpload/file/js/jquery.fileupload-process.js") },
        { "fileupload-image": srcurl("fileUpload/file/js/jquery.fileupload-image.js") },
        { "fileupload-audio": srcurl("fileUpload/file/js/jquery.fileupload-audio.js") },
        { "fileupload-video": srcurl("fileUpload/file/js/jquery.fileupload-video.js") },
        { "fileupload-validate": srcurl("fileUpload/file/js/jquery.fileupload-validate.js") },
        { "fileupload-ui": srcurl("fileUpload/file/js/jquery.fileupload-ui.js") },
        //framework
        { "jquery-pagination": srcurl("extendPagination.js", "/head-js/") },
        { "tools": srcurl("tools.js", "/head-js/") },
        { "menu-loader": srcurl("menu-loader.js", "/head-js/") },
        { "framwork-loader": srcurl("framwork-loader.js", "/head-js/") },
        { "importxls-acc": srcurl("importxls/js/excel.acc.js") },////
        { "table-loader-v2": srcurl("table-loader-v2.js", "/head-js/") },
        { "form-tool-v2": srcurl("form-tool-v2.js", "/head-js/") },
        { "form-tool": srcurl("form-tool.js","/head-js/") }
    ],
    ready: function () {
        layui.config({
            dir: srcurl("layui/1.0.9/") //layui.js 所在路径（注意,如果是script单独引入layui.js,无需设定该参数。）,一般情况下可以无视
            ,
            version: false //一般用于更新模块缓存,默认不开启。设为true即让浏览器不缓存。也可以设为一个固定的值,如：201610
            ,
            debug: false //用于开启调试模式,默认false,如果设为true,则JS模块的节点会保留在页面
            ,
            base: srcurl("layui/1.0.9/lay/modules/") //设定扩展的Layui模块的所在目录,一般用于外部模块扩展
        }).use("index");
    }
};

_c.lib = _c.isApp ? _c.app.lib : _c.pc.lib;




//加载资源
head.load(_c.lib.src);
head.ready(_c.lib.ready);
//特殊页面处理
window.onload = function () {
    $.log(_c);
    //debugger 
    var uid = $.uid();
    var unitid = $.unitid();
    //处理自动登陆
    if (_c.isAutoLoginPage()) {
        // debugger
        $("body").html("");
        $.loading();
        $.msg("请稍后...");
        autoLogin($.q("userId"), $.q("roleString"));
        return;
    }
    if (_c.isLoginPage()) {
        //if ($.hasValue(_c.pc.login_3rd)) {
        //    //第三方登陆
        //    $("body").html("");
        //    $.loading();
        //    $.msg("请稍后...");
        //    //   debugger 
        //    window.location.replace(_c.pc.login_3rd);
        //    return;
        //}
        $('#login').click(function () {
            var userid = $('#uid').val();
            var psw = $('#psw').val();
            login(userid, psw);
        });
        return;
    }
    //登陆验证
    if (_c.isVisitor()) {
        $.warn("请登陆");
        if ($.hasValue(_c.login_third)) {
            $.go(_c.login_third + "?returnUrl=" + _c.login_auto);
        } else {
            $.go(_c.login);
        } 
        return;
    }
    //登陆成功后
    $("#user_id").text($.cookie('user_id'));
    $("#nick_name").val($.cookie('nick_name')); $(".nick_name").text($.cookie('nick_name'));
    $("#unit_name").text($.cookie('unit_name'));//显示用户id//显示用户id
    $(".fa-sign-out").click(function () {//设置退出登录
        $.cookie();
        $.msg("已退出登录");
        $.go(_c.pc.login);
    });
   
    if (_c.isApp) {
        $.loadBll();//加载业务js
        $.bindFunction();//自动绑定页面参数
        $(".back").click(function () { $.go(-1) });//后退按钮

    } else {
        //需要拉取工作流待办
        InitWorkFlow();
        //报表初始化
        if ($.geturl() === _c.pc.report) {
            //id为报表的数据api地址
            qx.grid.InitReport($.q("id"));
        }
        //表单初始化
        else if ($.geturl() === _c.pc.form) {
            //sdebugger 
            //id为js路径或自定义页面路径
            InitForm($.q("id"));
        }
        //首页初始化
        else if ($.geturl() === _c.pc.homepage) {
            menuStageTwo(uid);
        }
        else {
        }
    }



};



function confirmPay(totalFee) {
    $.loading();
    $.go(g_pay_wx + "?uid=" + $.uid() + "&total_fee=" + totalFee + "&return_url=" + g_pay_result_wx);
}
function YibanLogin() {

    $.go(_c.sever.host + "/Oauth2/YiBan?returnUrl=" +localUrl(_c.pc.login_3rd_result));
}

function hide_m(objArray) {
    if (!$.isArray2(objArray)) {
        objArray = [objArray];
    }
    for (var i = 0; i < objArray.length; i++) {
        var arr = objArray[i];
        var name = arr[0];
        var value = arr.length > 1 ? arr[1] : "";
        $("body").append(' <input class="hidden" name="' + name + '" type="text" value="' + value + '">');
    }
}